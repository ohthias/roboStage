<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <title>Formulário de Pontuação</title>
    <style>
      .button-group button.selected {
        background-color: #4caf50;
        color: white;
      }
      .mission {
        margin-bottom: 20px;
        padding: 10px;
        border: 1px solid #ccc;
      }
    </style>
  </head>
  <body>
    <div id="selectionArea">
      <h2>Selecione a Equipe e a Arena</h2>
      <label for="teamSelect">Equipe:</label>
      <select id="teamSelect"></select>
      <br /><br />
      <label for="roundSelect">Round:</label>
      <select id="roundSelect"></select>
      <br /><br />
      <label for="arenaSelect">Arena:</label>
      <select id="arenaSelect"></select>
      <br /><br />
      <button onclick="startForm()">Iniciar</button>
    </div>

    <div id="formArea" style="display: none">
      <h2>Missões</h2>
      <div id="formContainer"></div>
      <h3 id="totalPoints">Pontuação Total: 0 pontos</h3>
      <button onclick="calculateScore()">Calcular Pontuação</button>
    </div>

    <script>
      const data = {
        mission: [
          {
            id: "EL",
            name: "INSPEÇÃO DE EQUIPAMENTOS",
            mission:
              "O robô e todos os equipamentos cabem em sua totalidade na área de lançamento e respeitam o limite de altura",
            points: 20,
            type: ["switch", "sim", "não"],
          },
          {
            id: "M01",
            name: "BERÇÁRIO DE CORAIS",
            mission: "A árvore de coral está pendurada no suporte apropriado",
            points: 20,
            type: ["switch", "sim", "não"],
            "sub-mission": [
              {
                submission:
                  "A parte de baixo da árvore de coral está em seu suporte",
                points: 10,
                type: ["switch", "sim", "não"],
              },
              {
                submission: "Os botões de coral estão virados para cima",
                points: 20,
                type: ["switch", "sim", "não"],
              },
            ],
          },
          {
            id: "M02",
            name: "TUBARÃO",
            mission: "O tubarão não está tocando a caverna",
            points: 20,
            type: ["switch", "sim", "não"],
            "sub-mission": [
              {
                submission:
                  "O tubarão está tocando o tapete e está pelo menos parcialmente dentro do habitat dele",
                points: 10,
                type: ["switch", "sim", "não"],
              },
            ],
          },
          {
            id: "M03",
            name: "RECIFE DE CORAIS",
            mission:
              "O recife de corais está virado para cima e não está tocando o tapete",
            points: 20,
            type: ["switch", "sim", "não"],
            "sub-mission": [
              {
                submission:
                  "Número de segmentos do recife que estão de pé, fora área de lançamento e tocando o tapete",
                points: 5,
                type: ["range", 0, 3],
              },
            ],
          },
          {
            id: "M04",
            name: "MERGULHADOR",
            mission: "O mergulhador não está mais tocando o berçário de corais",
            points: 20,
            type: ["switch", "sim", "não"],
            "sub-mission": [
              {
                submission:
                  "O mergulhador está segurando no suporte do recife de corais",
                points: 20,
                type: ["switch", "sim", "não"],
              },
            ],
          },
          {
            id: "M05",
            name: "PEIXE PESCADOR",
            mission: "O peixe-pescador está preso ao navio naufragado",
            points: 30,
            type: ["switch", "sim", "não"],
          },
          {
            id: "M06",
            name: "SUBA O MASTRO",
            mission: "O mastro do navio naufragado está totalmente de pé",
            points: 30,
            type: ["switch", "sim", "não"],
          },
          {
            id: "M07",
            name: "TESOURO DO KRAKEN",
            mission:
              "O baú do tesouro está completamente fora do ninho do kraken",
            points: 20,
            type: ["switch", "sim", "não"],
          },
          {
            id: "M08",
            name: "HABITAT ARTIFICIAL",
            mission:
              "Número de segmentos do habitat artificial empilhados, totalmente planificados e verticais",
            points: 10,
            type: ["range", 0, 4],
          },
          {
            id: "M09",
            name: "UM ENCONTRO INESPERADO",
            mission: "A criatura desconhecida foi libertada",
            points: 20,
            type: ["switch", "sim", "não"],
            "sub-mission": [
              {
                submission:
                  "Ao menos parte da criatura desconhecida está na emanação fria",
                points: 10,
                type: ["switch", "sim", "não"],
              },
            ],
          },
          {
            id: "M10",
            name: "ENVIE O NAVIO",
            mission: "A bandeira amarela da sua equipe não está hasteada",
            points: 30,
            type: ["switch", "sim", "não"],
            "sub-mission": [
              {
                submission:
                  "O submarino está claramente mais próximo do campo oposto",
                points: 10,
                type: ["switch", "sim", "não"],
              },
            ],
          },
          {
            id: "M11",
            name: "DESCOBERTA DO SONAR",
            mission: "Número de baleias revelado",
            points: 20,
            type: ["range", 0, 2],
          },
          {
            id: "M12",
            name: "ALIMENTE A BALEIA",
            mission:
              "Número de krills que estão ao menos parcialmente na boca da baleia",
            points: 10,
            type: ["range", 0, 5],
          },
          {
            id: "M13",
            name: "MUDE O NAVIO DE ROTA",
            mission: "O navio está na nova rota, tocando o tapete",
            points: 20,
            type: ["switch", "sim", "não"],
          },
          {
            id: "M14",
            name: "COLETA DE AMOSTRAS",
            mission:
              "A amostra de água está completamente fora da área de amostras",
            points: 5,
            type: ["switch", "sim", "não"],
            "sub-mission": [
              {
                submission:
                  "A amostra do fundo do mar não está mais tocando o próprio fundo",
                points: 10,
                type: ["switch", "sim", "não"],
              },
              {
                submission:
                  "A amostra de plâncton não está mais tocando a floresta de algas",
                points: 10,
                type: ["switch", "sim", "não"],
              },
              {
                submission:
                  "Número de partes do tridente que não está mais tocando o navio naufragado",
                points: 20,
                type: ["range", 0, 2],
              },
            ],
          },
          {
            id: "M15",
            name: "EMBARCAÇÃO DE PESQUISA",
            mission:
              "Número de amostras, partes do tridente ou baús de tesouro que estão ao menos em parte na área de carga da embarcação",
            points: 5,
            type: ["range", 0, 6],
            "sub-mission": [
              {
                submission:
                  "Ao menos parte do biestável da porta está no ciclo da embarcação de pesquisa",
                points: 20,
                type: ["switch", "sim", "não"],
              },
            ],
          },
          {
            id: "PT",
            name: "TOKENS DE PRECISÃO",
            mission: "Número de tokens de precisão restantes",
            points: [0, 10, 15, 25, 35, 50, 50],
            type: ["range", 0, 6],
          },
          {
            id: "GP",
            name: "Gracious Professionalism®",
            mission: "Gracious Professionalism® demonstrados durante o round:",
            type: ["switch", "Em desenvolvimento", "Comprido", "Excede"],
          },
        ],
        team: ["Team A", "Team B", "Team C", "Team D", "Team E", "Team F"],
        arena: ["Arena A", "Arena B"],
        round: ["1º Round", "2º Round", "3º Round", "Semi-final", "Final"],
      };

      const teamSelect = document.getElementById("teamSelect");
      const arenaSelect = document.getElementById("arenaSelect");
      const formContainer = document.getElementById("formContainer");
      const roundSelect = document.getElementById("roundSelect");

      data.team.forEach((team) => {
        const opt = document.createElement("option");
        opt.value = opt.innerText = team;
        teamSelect.appendChild(opt);
      });

      data.arena.forEach((arena) => {
        const opt = document.createElement("option");
        opt.value = opt.innerText = arena;
        arenaSelect.appendChild(opt);
      });

      data.round.forEach((round) => {
        const opt = document.createElement("option");
        opt.value = opt.innerText = round;
        roundSelect.appendChild(opt);
      });

      function startForm() {
        const selectedTeam = teamSelect.value;
        const selectedArena = arenaSelect.value;
        const selectedRound = roundSelect.value;

        if (!selectedTeam || !selectedArena || !roundSelect) {
          alert("Selecione a equipe e a arena.");
          return;
        }

        document.getElementById("selectionArea").style.display = "none";
        document.getElementById("formArea").style.display = "block";

        data.mission.forEach((mission) => {
          const missionDiv = document.createElement("div");
          missionDiv.className = "mission";
          missionDiv.dataset.id = mission.id;
          missionDiv.dataset.type = mission.type[0];
          missionDiv.dataset.points = JSON.stringify(mission.points);

          const title = document.createElement("h4");
          title.innerText = `${mission.id} - ${mission.name}`;
          missionDiv.appendChild(title);

          const description = document.createElement("p");
          description.innerText = mission.mission;
          missionDiv.appendChild(description);

          const buttonsDiv = document.createElement("div");
          buttonsDiv.className = "button-group";

          if (mission.type[0] === "switch") {
            ["sim", "não"].forEach((option) => {
              const btn = document.createElement("button");
              btn.innerText = option;
              btn.onclick = () => selectOption(missionDiv, btn, option);
              buttonsDiv.appendChild(btn);
            });
          } else if (mission.type[0] === "range") {
            const min = mission.type[1];
            const max = mission.type[2];
            for (let i = min; i <= max; i++) {
              const btn = document.createElement("button");
              btn.innerText = i;
              btn.onclick = () => selectOption(missionDiv, btn, i);
              buttonsDiv.appendChild(btn);
            }
          }

          missionDiv.appendChild(buttonsDiv);
          formContainer.appendChild(missionDiv);
        });
      }

      function selectOption(container, button, value) {
        const buttons = container.querySelectorAll("button");
        buttons.forEach((btn) => btn.classList.remove("selected"));
        button.classList.add("selected");
        container.dataset.selected = value;
      }

      function calculateScore() {
        let total = 0;

        document.querySelectorAll(".mission").forEach((div) => {
          const type = div.dataset.type;
          const selected = div.dataset.selected;

          if (!selected) return;

          let points = JSON.parse(div.dataset.points);

          if (type === "switch") {
            if (selected === "sim") {
              if (Array.isArray(points)) {
                total += points[1] || 0;
              } else {
                total += points;
              }
            }
          } else if (type === "range") {
            const value = parseInt(selected);
            if (Array.isArray(points)) {
              total += points[value] || 0;
            } else {
              total += value * points;
            }
          }
        });

        document.getElementById(
          "totalPoints"
        ).innerText = `Pontuação Total: ${total} pontos`;
        const team = teamSelect.value;
        const arena = arenaSelect.value;
        const round = roundSelect.value;

        const resultado = {
          team,
          arena,
          pontos: total,
        };

        localStorage.setItem(
          `pontuacao_${team}_${arena}_${round}`,
          JSON.stringify(resultado)
        );
        document.getElementById(
          "totalPoints"
        ).innerText = `Pontuação Total: ${total} pontos (Salvo!)`;
      }
    </script>
  </body>
</html>
